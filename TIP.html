<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TIP Skill Guide</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .header-section {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }

        .skill-letter {
            font-size: 36px;
            font-weight: bold;
            color: #1890ff;
            margin-right: 10px;
            display: inline-block;
            width: 50px;
            height: 50px;
            text-align: center;
            line-height: 50px;
            border-radius: 50%;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .practice-card {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .example-section {
            background-color: #fff8e6;
            border-left: 4px solid #faad14;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .quote {
            font-style: italic;
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin: 20px 0;
        }

        .interactive-section {
            background-color: #f6ffed;
            border-left: 4px solid #52c41a;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .scenario-card {
            background-color: white;
            border: 1px solid #e8e8e8;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .response-card {
            background-color: #f0f8ff;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .response-card.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .response-card.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
    </style>
</head>

<body>
    <div class="float-end">
        <small class="text-muted">Time spent: <span id="timer-display">00:00</span></small>
    </div>
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-8 offset-md-2">
                <h1 class="text-center mb-4">The TIP Skill</h1>
                <div class="header-section">
                    <h3 class="mb-3">Overview</h3>
                    <p>The TIP skill is a powerful crisis survival strategy in DBT (Dialectical Behavior Therapy)
                        designed to help you quickly change your body's chemistry to reduce overwhelming emotions. TIP
                        stands for <strong>Temperature</strong>, <strong>Intense exercise</strong>, <strong>Paced
                            breathing</strong>, and <strong>Paired muscle relaxation</strong>. This skill is
                        particularly useful when you need to calm down fast and regain control during moments of high
                        emotional arousal.</p>
                    <p>Each component of TIP targets a different aspect of your physical response to distress:</p>
                    <ul>
                        <li><strong>Temperature</strong>: Uses cold sensations to trigger a calming reflex.</li>
                        <li><strong>Intense Exercise</strong>: Burns off excess energy associated with strong emotions.
                        </li>
                        <li><strong>Paced Breathing</strong>: Slows your breathing to activate your relaxation response.
                        </li>
                        <li><strong>Paired Muscle Relaxation</strong>: Releases physical tension to ease your mind.</li>
                    </ul>
                    <p>Think of TIP as your emotional emergency toolkitâ€”quick, effective, and ready when you need it
                        most.</p>
                </div>
                <div class="practice-card">
                    <h3 class="mb-3">How to Practice TIP</h3>
                    <div class="mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <span class="skill-letter">T</span>
                            <h4 class="mb-0">Temperature</h4>
                        </div>
                        <p>Use cold water or ice to trigger the "dive reflex," which slows your heart rate and calms
                            your nervous system. This can be done by splashing cold water on your face, holding an ice
                            pack, or even taking a cold shower.</p>
                        <div class="quote">"When emotions are running hot, a cold splash can cool them down fast."</div>
                    </div>
                    <div class="mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <span class="skill-letter">I</span>
                            <h4 class="mb-0">Intense Exercise</h4>
                        </div>
                        <p>Engage in short bursts of vigorous physical activity to burn off the energy tied to intense
                            emotions. This could be running, jumping jacks, or any activity that gets your heart rate up
                            quickly.</p>
                        <div class="quote">"When your body is revved up, exercise can help bring it back to baseline."
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <span class="skill-letter">P</span>
                            <h4 class="mb-0">Paced Breathing</h4>
                        </div>
                        <p>Slow your breathing to activate your body's relaxation response. Try inhaling for 5 seconds
                            and exhaling for 7 seconds, or use box breathing (inhale 4, hold 4, exhale 4, hold 4).</p>
                        <div class="quote">"Breathing is the anchor that keeps you steady in the storm of emotions."
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <span class="skill-letter">P</span>
                            <h4 class="mb-0">Paired Muscle Relaxation</h4>
                        </div>
                        <p>Tense and then relax specific muscle groups while focusing on your breath. This helps release
                            physical tension that often accompanies emotional distress.</p>
                        <div class="quote">"Letting go of tension in your body can help let go of tension in your mind."
                        </div>
                    </div>
                </div>
                <div class="example-section">
                    <h3 class="mb-3">A Humorous Example: The Wedding Speech Disaster</h3>
                    <p><strong>The Situation:</strong> Alex is about to give a speech at their best friend's wedding.
                        They're extremely nervous, hands shaking, voice trembling. They feel like they're going to pass
                        out.</p>
                    <div class="mb-3"><strong>T - Temperature:</strong> Alex steps outside for a moment and holds a cold
                        glass of water against their wrists. The cold sensation snaps them out of their panic.</div>
                    <div class="mb-3"><strong>I - Intense Exercise:</strong> They do a few quick squats in the bathroom
                        to burn off nervous energy. It feels silly, but it works!</div>
                    <div class="mb-3"><strong>P - Paced Breathing:</strong> Before starting the speech, they take
                        several slow, deep breaths to steady their nerves.</div>
                    <div class="mb-3"><strong>P - Paired Muscle Relaxation:</strong> They tense and relax their
                        shoulders and neck muscles, releasing the tension.</div>
                    <p><strong>The Result:</strong> Alex delivers the speech with confidence, and everyone applauds.
                        They even get a few laughs with their well-timed jokes. Crisis averted!</p>
                </div>
                <div class="interactive-section">
                    <h3 class="mb-3">Practice Scenarios Quiz</h3>
                    <p>Test your understanding of how to apply the TIP skill in different situations:</p>
                    <div class="score-tracker mb-3">Current score: <span id="quiz-score">0 / 0</span></div>
                    <!-- Question 1 -->
                    <div class="card mb-4">
                        <div class="card-header">Scenario 1: The Panic Attack</div>
                        <div class="card-body">
                            <p>You're in a crowded store and suddenly feel a panic attack coming on. Your heart is
                                racing, and you feel like you can't breathe. Which TIP component would be most
                                appropriate to use first?</p>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-1" id="scenario-1-option-1"
                                    value="1" onclick="checkAnswer(1, 1, 3)">
                                <label class="form-check-label" for="scenario-1-option-1">Intense exercise - run out of
                                    the store</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-1" id="scenario-1-option-2"
                                    value="2" onclick="checkAnswer(1, 2, 3)">
                                <label class="form-check-label" for="scenario-1-option-2">Temperature - splash cold
                                    water on your face</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-1" id="scenario-1-option-3"
                                    value="3" onclick="checkAnswer(1, 3, 3)">
                                <label class="form-check-label" for="scenario-1-option-3">Paced breathing - start slow,
                                    deep breaths</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-1" id="scenario-1-option-4"
                                    value="4" onclick="checkAnswer(1, 4, 3)">
                                <label class="form-check-label" for="scenario-1-option-4">Paired muscle relaxation -
                                    tense and relax your muscles</label>
                            </div>
                            <div id="feedback-1" class="mt-3"></div>
                            <div id="response-1" class="response-card mt-3" style="display: none;">
                                <h6>TIP Skill Application:</h6>
                                <p><strong>Correct Answer:</strong> Paced breathing - start slow, deep breaths.</p>
                                <p><strong>Explanation:</strong> Paced breathing can help regulate your breathing and
                                    calm your nervous system quickly, which is crucial during a panic attack.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Question 2 -->
                    <div class="card mb-4">
                        <div class="card-header">Scenario 2: The Anger Outburst</div>
                        <div class="card-body">
                            <p>You're in a heated argument with a friend, and you feel your anger escalating. You're
                                about to say something hurtful. Which TIP component should you use?</p>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-2" id="scenario-2-option-1"
                                    value="1" onclick="checkAnswer(2, 1, 1)">
                                <label class="form-check-label" for="scenario-2-option-1">Temperature - hold an ice
                                    pack</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-2" id="scenario-2-option-2"
                                    value="2" onclick="checkAnswer(2, 2, 1)">
                                <label class="form-check-label" for="scenario-2-option-2">Intense exercise - go for a
                                    quick run</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-2" id="scenario-2-option-3"
                                    value="3" onclick="checkAnswer(2, 3, 1)">
                                <label class="form-check-label" for="scenario-2-option-3">Paced breathing - take deep
                                    breaths</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-2" id="scenario-2-option-4"
                                    value="4" onclick="checkAnswer(2, 4, 1)">
                                <label class="form-check-label" for="scenario-2-option-4">Paired muscle relaxation -
                                    tense and relax your fists</label>
                            </div>
                            <div id="feedback-2" class="mt-3"></div>
                            <div id="response-2" class="response-card mt-3" style="display: none;">
                                <h6>TIP Skill Application:</h6>
                                <p><strong>Correct Answer:</strong> Temperature - hold an ice pack.</p>
                                <p><strong>Explanation:</strong> The cold sensation can help snap you out of the intense
                                    emotion and give you a moment to pause before reacting.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Question 3 -->
                    <div class="card mb-4">
                        <div class="card-header">Scenario 3: The Overwhelming Stress</div>
                        <div class="card-body">
                            <p>You have a deadline approaching, and you're feeling overwhelmed and stressed. Your mind
                                is racing, and you can't focus. Which TIP component could help you regain focus?</p>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-3" id="scenario-3-option-1"
                                    value="1" onclick="checkAnswer(3, 1, 4)">
                                <label class="form-check-label" for="scenario-3-option-1">Temperature - take a cold
                                    shower</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-3" id="scenario-3-option-2"
                                    value="2" onclick="checkAnswer(3, 2, 4)">
                                <label class="form-check-label" for="scenario-3-option-2">Intense exercise - do some
                                    jumping jacks</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-3" id="scenario-3-option-3"
                                    value="3" onclick="checkAnswer(3, 3, 4)">
                                <label class="form-check-label" for="scenario-3-option-3">Paced breathing - practice box
                                    breathing</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="scenario-3" id="scenario-3-option-4"
                                    value="4" onclick="checkAnswer(3, 4, 4)">
                                <label class="form-check-label" for="scenario-3-option-4">Paired muscle relaxation -
                                    progressively relax your body</label>
                            </div>
                            <div id="feedback-3" class="mt-3"></div>
                            <div id="response-3" class="response-card mt-3" style="display: none;">
                                <h6>TIP Skill Application:</h6>
                                <p><strong>Correct Answer:</strong> Paired muscle relaxation - progressively relax your
                                    body.</p>
                                <p><strong>Explanation:</strong> Releasing physical tension can help calm your mind and
                                    improve focus, making it easier to tackle the task at hand.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Final Score Section -->
                    <div id="final-score-section" class="alert alert-info text-center" style="display: none;">
                        <h4>Quiz Complete!</h4>
                        <p>Your final score: <span id="final-score"></span></p>
                        <p>Now that you've tested your understanding, try applying the TIP skill in real-life
                            situations.</p>
                        <div class="mb-3 mt-3">
                            <label for="user-notes" class="form-label">Notes or Questions for Your Therapist
                                (Optional)</label>
                            <textarea class="form-control" id="user-notes" rows="3"
                                placeholder="Enter any notes or questions about this skill..."></textarea>
                        </div>
                        <button class="btn btn-primary mt-2 btn-log-session" onclick="logSessionWithQuiz()">Complete
                            Practice Session</button>
                    </div>
                    <h3>When to Use the TIP Skill</h3>
                    <ul>
                        <li>When experiencing intense anxiety or panic.</li>
                        <li>When feeling overwhelming anger or frustration.</li>
                        <li>When dealing with acute stress or pressure.</li>
                        <li>When needing to quickly calm down before making a decision.</li>
                        <li>When your emotions are so strong that they cloud your judgment.</li>
                    </ul>
                    <p><strong>Note:</strong> TIP is for short-term relief. Pair it with other DBT skills for long-term
                        emotion regulation.</p>
                </div>
            </div>
        </div>
    </div>
    <div id="confirmation-message" class="alert alert-success text-center mt-5" style="display: none;">
        <!-- Content set dynamically -->
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Common variables
        let startTime;
        let timeSpent = 0;
        let timerInterval;
        let quizScore = 0;
        let questionsAnswered = 0;
        let quizCompleted = false;

        // Skill-specific variables
        let totalQuestions = 3;
        let skillInfo = {
            name: 'TIP',
            type: 'Crisis Survival',
            totalQuestions: totalQuestions
        };

        // Start timer when page loads
        document.addEventListener('DOMContentLoaded', function () {
            startTimer();
            google.script.run.trackSkillGuideView('TIP');
        });

        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const currentTime = new Date();
            timeSpent = Math.floor((currentTime - startTime) / 1000); // time in seconds
            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            document.getElementById('timer-display').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function checkAnswer(scenarioId, selectedOption, correctOption) {
            const responseDiv = document.getElementById(`response-${scenarioId}`);
            const feedbackDiv = document.getElementById(`feedback-${scenarioId}`);
            questionsAnswered++;
            if (selectedOption === correctOption) {
                quizScore++;
                feedbackDiv.innerHTML = '<div class="alert alert-success">Correct! Great application of the skill.</div>';
            } else {
                feedbackDiv.innerHTML = '<div class="alert alert-danger">Not quite. Review the correct application above.</div>';
            }
            responseDiv.style.display = 'block';
            updateQuizScore();
            const options = document.querySelectorAll(`input[name="scenario-${scenarioId}"]`);
            options.forEach(option => option.disabled = true);
        }

        function updateQuizScore() {
            const scoreDisplay = document.getElementById('quiz-score');
            scoreDisplay.textContent = `${quizScore} / ${questionsAnswered}`;
            if (questionsAnswered === totalQuestions) {
                document.getElementById('final-score-section').style.display = 'block';
                document.getElementById('final-score').textContent = `${quizScore} / ${totalQuestions}`;
                quizCompleted = true;
            }
        }

        function logSessionWithQuiz() {
            clearInterval(timerInterval);
            const logButton = document.querySelector('.btn-log-session');
            logButton.disabled = true;
            logButton.textContent = "Logging...";

            const userNotes = document.getElementById('user-notes').value;
            let notesText = `${skillInfo.name} Skill Quiz: Score ${quizScore}/${skillInfo.totalQuestions}. `;
            if (userNotes) notesText += `User notes: ${userNotes}`;

            const logData = {
                skillType: skillInfo.type,
                skillName: skillInfo.name,
                distressBefore: 0,
                distressAfter: 0,
                effectiveness: Math.min(5, Math.ceil((quizScore / skillInfo.totalQuestions) * 5)),
                timeSpent: timeSpent / 60, // Convert to minutes
                quizScore: `${quizScore}/${skillInfo.totalQuestions}`,
                notes: notesText
            };

            google.script.run
                .withSuccessHandler(function (result) {
                    try {
                        logButton.textContent = "Logged Successfully!";
                        document.getElementById('return-after-quiz').style.display = 'block';
                        document.getElementById('confirmation-message').style.display = 'block';
                        document.getElementById('time-spent').textContent = `${Math.floor(timeSpent / 60)} minutes and ${timeSpent % 60} seconds`;
                    } catch (error) {
                        console.error("Error in success handler:", error);
                        alert("Your skill practice was logged, but there was an error updating the display.");
                    }
                })
                .withFailureHandler(function (error) {
                    try {
                        console.error("Error logging session:", error);
                        alert('Error logging session: ' + error);
                        logButton.disabled = false;
                        logButton.textContent = "Complete Practice Session";
                    } catch (handlingError) {
                        console.error("Error handling failure:", handlingError);
                        alert("An unexpected error occurred. Please try again.");
                        logButton.disabled = false;
                    }
                })
                .logSkillWithTime(logData);
        }

        function logSkillWithTime(skillName, timeSpent, quizScore) {
            const logData = {
                skillName: skillName,
                timeSpent: parseFloat(timeSpent) || 0,
                quizScore: quizScore || ''
            };
            google.script.run
                .withSuccessHandler(result => {
                    alert(result);
                })
                .withFailureHandler(error => {
                    alert('Error logging session: ' + error.message);
                })
                .logSkillWithTime(logData);
        }
    </script>
</body>

</html>